# طراحی و پیاده‌سازی سامانه (DoH (HTTPS over DNS با قابلیت مدیریت رکوردهای DNS

## هدف پروژه
این پروژه یک سرور DNS سفارشی است که درخواست‌های DNS را دریافت، پردازش و پاسخ می‌دهد و به کاربر امکان مدیریت رکوردها و مشاهده لاگ‌ها از طریق رابط کاربری گرافیکی (GUI) را می‌دهد. هدف آن ارائه پاسخ سریع به درخواست‌های کلاینت و ذخیره رکوردها برای استفاده‌های بعدی است. سرور علاوه بر پاسخ‌دهی به درخواست‌های داخلی، قابلیت پرس‌وجو از یک سرور DNS خارجی (Upstream DNS) را نیز دارد.

---

## امکانات پیاده‌سازی شده

### 1. بخش سرور DNS
- دریافت درخواست‌های DNS روی پورت مشخص (53 در نسخه نهایی، قابل تغییر به 8053).  
- پشتیبانی از UDP برای پردازش درخواست‌ها.  
- پاسخ‌دهی مطابق ساختار استاندارد DNS با پردازش انواع رکوردها: **A, NS, CNAME, MX**.

### 2. DNS over HTTPS (DoH)
- مسیر وبی `/query-dns/` برای دریافت درخواست‌های DoH ایجاد شده است.  
- پشتیبانی از روش‌های **GET** و **POST**.  
- داده‌ها می‌توانند در قالب **JSON** ارسال و دریافت شوند.

### 3. مدیریت رکوردها
- امکان افزودن، حذف و ویرایش رکوردها از طریق **رابط کاربری گرافیکی (GUI Web)** فراهم شده است.  
- رکوردها در **SQLite** ذخیره می‌شوند و شامل اطلاعات:  
  • نام دامنه  
  • نوع رکورد (A, NS, CNAME, MX)  
  • مقدار رکورد (IP یا نام دامنه)  
  • TTL (زمان اعتبار)  
  • اولویت (برای رکورد MX)

### 4. ارتباط با DNS های بالادستی
- در صورت نبود رکورد در کش یا دیتابیس، درخواست به سرورهای عمومی (مثل 8.8.8.8) ارسال و پاسخ دریافت شده به کاربر بازگردانده می‌شود.  
- پاسخ‌ها در کش و دیتابیس ذخیره می‌شوند تا در درخواست‌های بعدی سریع‌تر پاسخ داده شوند.

### 5. بخش امتیازی
- **Cache:** پیاده‌سازی شده و نتایج درخواست‌ها برای کاهش زمان پاسخ ذخیره می‌شوند.  
- **Log:** ثبت درخواست‌ها و پاسخ‌ها به دیتابیس انجام می‌شود.  
- **GUI:** رابط گرافیکی ساده برای مدیریت رکوردها طراحی شده است.  
- **CLI برای تست DoH:** امکان تست از طریق ابزارهای خط فرمان فراهم شده است.

---

## جمع‌بندی
پروژه امکانات اصلی مورد انتظار استاد را برآورده کرده و قابلیت توسعه برای امکانات اختیاری (مانند رکوردهای TXT و PTR، احراز هویت مدیر و HTTPS کامل) نیز وجود دارد. سامانه توانایی مدیریت رکوردها، پاسخ‌دهی DNS و DoH، کش، ثبت لاگ و رابط کاربری گرافیکی را دارد و آماده استفاده و توسعه بیشتر است.

---

## نحوه اجرا کردن پروژه

### 1. پیش‌نیازها
- نصب **Python 3.9+**  
- نصب پکیج‌های مورد نیاز با دستور:  
  ```bash
  pip install -r requirements.txt
  ```
اطمینان از باز بودن پورت 53 برای UDP (برای تست محلی می‌توان پورت 8053 را جایگزین کرد).

### 2. اجرای سرور DNS

وارد پوشه پروژه شوید و دستور زیر را اجرا کنید:
```python
python dns_server.py
```

سرور شروع به گوش دادن درخواست‌های DNS و DoH می‌کند.

### 3. استفاده از رابط کاربری گرافیکی (GUI Web)

مرورگر خود را باز کنید و آدرس زیر را وارد کنید:

http://localhost:8000


از طریق رابط کاربری می‌توانید رکوردها را اضافه، حذف یا ویرایش کنید و لاگ درخواست‌ها را مشاهده کنید.

### 4. تست DoH یا رکوردها از طریق CLI

برای تست DoH می‌توانید از ابزار خط فرمان مانند curl یا nslookup استفاده کنید.

مثال nslookup:
```bash
nslookup -type=MX microsoft.com 127.0.0.1
```


نکته: در صورت استفاده از پورت 53 روی ویندوز، اجرای ترمینال با Run as Administrator الزامی است.
